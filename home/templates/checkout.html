{% extends 'base.html' %}
{% block content %}

<!-- ðŸ›’ Product List -->
<div class="card mb-3 shadow-sm">
  <div class="card-body">
    {% for item in items %}
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="d-flex align-items-center">
          {% if item.product.image %}
            <img src="{{ item.product.image.url }}" 
                 style="width:70px;height:70px;object-fit:cover;border-radius:8px;">
          {% endif %}
          <div class="ms-3">
            <div class="fw-semibold">{{ item.product.name }}</div>
            <div class="text-muted small">
              â‚¹{{ item.product.price }} Ã—
              {% if is_buy_now %}
                <!-- Buy Now quantity dropdown -->
                <form method="get" action="/buy-now/{{ item.product.id }}/" class="d-inline">
                  <select name="qty" class="form-select form-select-sm d-inline w-auto"
                          onchange="this.form.submit()">
                    {% for q in qty_options %}
                      <option value="{{ q }}" {% if q == item.quantity %}selected{% endif %}>{{ q }}</option>
                    {% endfor %}
                  </select>
                </form>
              {% else %}
                {{ item.quantity }}
              {% endif %}
            </div>
          </div>
        </div>
        <div class="fw-bold text-success">â‚¹{{ item.total }}</div>
      </div>
      {% if not forloop.last %}<hr class="my-2">{% endif %}
    {% endfor %}
  </div>
</div>

<!-- ðŸ§¾ Order Summary -->
<div class="card mb-3 shadow-sm">
  <div class="card-body">
    <div class="d-flex justify-content-between">
      <span>Item Total</span>
      <span>â‚¹{{ total_price }}</span>
    </div>
    <div class="d-flex justify-content-between">
      <span>Delivery</span>
      <span>{% if delivery == 0 %}Free{% else %}â‚¹{{ delivery }}{% endif %}</span>
    </div>
    <hr>
    <div class="d-flex justify-content-between fw-bold">
      <span>Total Amount</span>
      <span>â‚¹{{ total }}</span>
    </div>
  </div>
</div>

<!-- ðŸšš Address & Payment -->
<form action="/placeorder/" method="post">
  {% csrf_token %}
  <h5 class="mb-2">Select Delivery Address</h5>

  {% for address in addresses %}
    <div class="form-check mb-2">
      <input class="form-check-input" type="radio" name="selected_address"
             id="addr{{ address.id }}" value="{{ address.id }}" 
             {% if forloop.first %}checked{% endif %}>
      <label class="form-check-label" for="addr{{ address.id }}">
        <strong>{{ address.full_name }}</strong><br>
        {{ address.address_line }}, {{ address.city }}, {{ address.state }} - {{ address.pincode }}<br>
        Phone: {{ address.phone }}
      </label>
    </div>
  {% empty %}
    <div class="alert alert-warning">
      No saved address. Please add one below.
    </div>
  {% endfor %}

  <!-- âž• Add Address button -->
  <button type="button" class="btn btn-outline-warning w-100 mt-2" 
          data-bs-toggle="modal" data-bs-target="#addAddressModal">
    + Add New Address
  </button>

  <!-- ðŸ’³ Payment Methods -->
  <h5 class="mt-4 mb-2">Select Payment Method</h5>
  <div class="form-check mb-2">
    <input class="form-check-input" type="radio" name="payment_method" id="cod" value="cod" checked>
    <label class="form-check-label" for="cod">Cash on Delivery</label>
  </div>
  <div class="form-check mb-2">
    <input class="form-check-input" type="radio" name="payment_method" id="card" value="card">
    <label class="form-check-label" for="card">Card Payment</label>
  </div>
  <div class="form-check mb-2">
    <input class="form-check-input" type="radio" name="payment_method" id="upi" value="upi">
    <label class="form-check-label" for="upi">UPI</label>
  </div>
  <div class="form-check mb-2">
    <input class="form-check-input" type="radio" name="payment_method" id="netbanking" value="netbanking">
    <label class="form-check-label" for="netbanking">Net Banking</label>
  </div>

  <button type="submit" class="btn btn-success w-100 py-3 fw-bold mt-3">
    Place Order
  </button>
</form>


<!-- ðŸ“Œ Add Address Modal -->
<div class="modal fade" id="addAddressModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="/addaddress/">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title">Add New Address</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label">Full Name</label>
            <input type="text" name="full_name" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Address Line</label>
            <input type="text" name="address_line" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">City</label>
            <input type="text" name="city" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">State</label>
            <input type="text" name="state" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Pincode</label>
            <input type="text" name="pincode" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Phone</label>
            <input type="text" name="phone" class="form-control" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Save Address</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}

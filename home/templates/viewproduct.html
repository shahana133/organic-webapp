{% extends 'base.html' %}
{% load static %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="container my-5">

  <!-- Back Button -->
  <a href="/products/" class="btn btn-outline-success mb-4">â† Back to Products</a>

  <!-- Product Section -->
  <div class="row align-items-center">
    <div class="col-md-5 text-center">
      {% if product.image %}
        <img src="{{ product.image.url }}" class="img-fluid rounded shadow-sm" alt="{{ product.name }}">
      {% else %}
        <img src="{% static 'images/placeholder.png' %}" class="img-fluid rounded shadow-sm" alt="No image available">
      {% endif %}
    </div>

    <div class="col-md-7">
      <h2 class="fw-bold">{{ product.name }}</h2>

      {% if product.details %}
        <p class="text-muted mb-3">{{ product.details }}</p>
      {% endif %}

      <h4 class="text-success mb-3">â‚¹{{ product.price }} / {{ product.unit }}</h4>

      <p><strong>Category:</strong> {{ product.ctgry.name|default:"Not Assigned" }}</p>

      <p><strong>Average Rating:</strong>
        {% with avg=product.average_rating|floatformat:1 %}
          {{ avg }}/5 â˜…
        {% endwith %}
      </p>

      {% if product.user %}
        <p>
          <strong>ğŸ‘¨â€ğŸŒ¾ Farmer:</strong>
          <a href="/farmerprofile/{{ product.user.id }}/" class="text-decoration-none text-success fw-bold">
            {{ product.user.username }}
          </a>
        </p>
      {% endif %}
    </div>
  </div>

  {% if user.is_authenticated and user.userprofile.role == 'customer' %}
    <div class="mt-4 text-center">
      <a href="/addtocart/{{ product.id }}/" class="btn btn-outline-success btn-lg" style="width: 200px;">
        ğŸ›’ Add to Cart
      </a>
    </div>
  {% endif %}

  <hr class="my-5">

  <!-- Reviews Section -->
  <div class="row">
    <div class="col-md-8 mx-auto">
      <h4 class="fw-bold mb-4 text-success">Customer Reviews</h4>

      {% if reviews %}
        {% for review in reviews %}
          <div class="card mb-3 border-0 shadow-sm">
            <div class="card-body bg-light rounded-3">

              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="fw-bold mb-0">{{ review.user.username }}</h6>
                <span class="badge bg-success">â˜… {{ review.rating }}/5</span>
              </div>

              <p class="text-secondary mb-1">{{ review.comment }}</p>

              {% if review.review_image %}
              <div class="mt-3">
                <a href="{{ review.review_image.url }}" target="_blank">
                  <img src="{{ review.review_image.url }}"
                       alt="Review Image"
                       style="max-width: 360px; width:100%; height:auto; border-radius:8px;"/>
                </a>
              </div>
              {% endif %}

              <small class="text-muted d-block mt-3">Posted on {{ review.created_at|date:"M d, Y" }}</small>

            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="alert alert-secondary text-center">No reviews yet.</div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
